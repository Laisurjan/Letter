<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>æ‡‰ç”¨æ–‡ï½œæ›¸ä¿¡äº’å‹•æ•™å­¸ï¼ˆä¿¡å°æ ¼å¼ï¼‹ç”¨èªï¼‹å°æ¸¬é©—ï¼‰</title>
  <style>
    :root{
      --bg:#070A13;
      --panel:#0B1020;
      --panel2:#0F1730;
      --card:#0B1226;
      --border:rgba(255,255,255,.10);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.68);
      --muted2:rgba(255,255,255,.52);
      --accent:#7CDBFF;
      --accent2:#9B7CFF;
      --good:#5BFFB2;
      --warn:#FFCE6B;
      --bad:#FF6B8B;

      --radius:18px;
      --shadow: 0 16px 40px rgba(0,0,0,.45);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: system-ui, -apple-system, "Segoe UI", "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", sans-serif;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; font-family:var(--sans); color:var(--text); background: radial-gradient(1200px 700px at 20% 0%, rgba(124,219,255,.15), transparent 55%),
                                                           radial-gradient(900px 600px at 90% 15%, rgba(155,124,255,.12), transparent 55%),
                                                           linear-gradient(180deg, #050711, #06081a 40%, #040510); }
    a{ color:inherit; }
    button{ font-family:inherit; }
    .wrap{ max-width:1100px; margin:0 auto; padding:20px 16px 40px; }
    .topbar{
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      padding:16px 16px; border:1px solid var(--border); background: rgba(10,14,30,.72);
      border-radius: var(--radius); box-shadow: var(--shadow); backdrop-filter: blur(10px);
      position: sticky; top: 10px; z-index: 10;
    }
    .brand{ display:flex; gap:12px; align-items:center; }
    .logo{
      width:44px; height:44px; border-radius: 14px;
      background: radial-gradient(circle at 30% 25%, rgba(124,219,255,.95), rgba(124,219,255,.15) 45%, transparent 65%),
                  radial-gradient(circle at 70% 70%, rgba(155,124,255,.85), rgba(155,124,255,.15) 40%, transparent 70%),
                  linear-gradient(180deg, rgba(255,255,255,.18), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.16);
    }
    .titlebox{ line-height:1.15; }
    .titlebox .h1{ font-weight:800; letter-spacing:.4px; font-size: 16px; }
    .titlebox .sub{ color:var(--muted); font-size: 12px; margin-top:4px; }

    .controls{ display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; }
    .btn{
      border:1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.03));
      color:var(--text);
      padding:10px 12px;
      border-radius: 14px;
      cursor:pointer;
      font-weight:650;
      font-size: 13px;
      display:inline-flex; align-items:center; gap:8px;
      transition: transform .08s ease, border-color .12s ease, background .12s ease;
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); border-color: rgba(124,219,255,.35); }
    .btn:active{ transform: translateY(0px); }
    .btn.primary{
      border-color: rgba(124,219,255,.45);
      background: linear-gradient(180deg, rgba(124,219,255,.24), rgba(255,255,255,.06));
    }
    .btn.ghost{ background: transparent; }
    .pill{
      font-size: 12px; color: var(--muted);
      border:1px dashed rgba(255,255,255,.20);
      padding:8px 10px;
      border-radius: 999px;
      white-space: nowrap;
    }

    .grid{ display:grid; grid-template-columns: 280px 1fr; gap:14px; margin-top:14px; }
    @media (max-width: 920px){
      .grid{ grid-template-columns: 1fr; }
      .topbar{ position: static; }
    }

    .side{
      border:1px solid var(--border);
      background: rgba(10,14,30,.62);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .side .section{ padding:14px 14px; border-top:1px solid rgba(255,255,255,.08); }
    .side .section:first-child{ border-top:none; }

    .tabs{ display:flex; flex-direction:column; gap:8px; padding:14px; }
    .tab{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      border-radius: 14px;
      padding:10px 12px;
      cursor:pointer;
      font-weight:720;
      font-size: 13px;
      display:flex; align-items:center; justify-content:space-between;
      transition: border-color .12s ease, background .12s ease;
    }
    .tab small{ color:var(--muted2); font-weight:650; }
    .tab.active{
      border-color: rgba(124,219,255,.45);
      background: linear-gradient(180deg, rgba(124,219,255,.18), rgba(255,255,255,.04));
    }

    .meta{
      display:flex; gap:8px; flex-wrap:wrap; align-items:center;
    }
    .meta .dot{
      width:8px; height:8px; border-radius:99px; background: rgba(124,219,255,.85);
      box-shadow: 0 0 0 4px rgba(124,219,255,.10);
    }
    .meta .txt{ font-size:12px; color:var(--muted); }

    .main{
      border:1px solid var(--border);
      background: rgba(10,14,30,.56);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      min-height: 560px;
    }

    .mainHeader{
      padding:16px 16px;
      border-bottom:1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.00));
      display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
    }
    .mainHeader .h2{ font-size:16px; font-weight:900; letter-spacing:.3px; }
    .mainHeader .desc{ margin-top:6px; color:var(--muted); font-size: 13px; line-height:1.55; }
    .badge{
      font-size:12px; font-weight:800; color: rgba(255,255,255,.88);
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      padding:8px 10px; border-radius: 999px; white-space:nowrap;
    }

    .mainBody{ padding:16px; }
    .cards{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    @media (max-width: 720px){ .cards{ grid-template-columns: 1fr; } }

    .card{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      border-radius: 16px;
      padding:14px;
    }
    .card h3{ margin:0 0 10px; font-size: 14px; font-weight:900; letter-spacing:.2px; }
    .card p{ margin:0; color: var(--muted); font-size: 13px; line-height: 1.7; }
    .card ul{ margin:10px 0 0; padding-left: 18px; color: var(--muted); font-size: 13px; line-height:1.75; }
    .k{ color: rgba(255,255,255,.92); font-weight:800; }
    .hint{ margin-top:10px; font-family: var(--mono); font-size: 12px; color: rgba(124,219,255,.92); }
    .miniRow{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
    .chip{
      border:1px solid rgba(124,219,255,.28);
      background: rgba(124,219,255,.10);
      padding:6px 10px; border-radius: 999px;
      font-size: 12px; font-weight:800; color: rgba(255,255,255,.90);
    }

    /* Envelope simulator */
    .simWrap{ display:grid; grid-template-columns: 1fr; gap:12px; }
    .simTop{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .simNote{ color: var(--muted); font-size: 13px; line-height:1.6; }

    .envelope{
      position: relative;
      border: 1px solid rgba(255,255,255,.12);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
      border-radius: 16px;
      overflow:hidden;
      min-height: 380px;
    }
    .envelope .paper{
      position:absolute; inset:14px;
      border-radius: 14px;
      background: rgba(255,255,255,.06);
      border: 1px dashed rgba(255,255,255,.16);
    }
    .envelope .stamp{
      position:absolute; width:90px; height:64px;
      border-radius: 12px;
      right: 22px; top: 22px;
      border:1px solid rgba(255,255,255,.24);
      background:
        radial-gradient(circle at 25% 30%, rgba(124,219,255,.65), transparent 55%),
        radial-gradient(circle at 70% 70%, rgba(155,124,255,.55), transparent 60%),
        rgba(255,255,255,.08);
      display:flex; align-items:center; justify-content:center;
      font-weight:900; letter-spacing:.6px; font-size: 12px;
      color: rgba(255,255,255,.92);
      text-align:center;
    }

    .field{
      position:absolute;
      border:1px solid rgba(124,219,255,.20);
      background: rgba(124,219,255,.06);
      border-radius: 14px;
      padding:10px;
      min-height: 74px;
      backdrop-filter: blur(6px);
    }
    .field .label{
      font-size: 11px; color: rgba(255,255,255,.70); font-weight:850; letter-spacing:.4px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .field .label .tag{
      font-size: 10px; padding:4px 8px; border-radius: 999px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.78);
      white-space: nowrap;
    }
    .field .value{
      margin-top:8px;
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(255,255,255,.92);
      line-height: 1.45;
      white-space: pre-wrap;
    }
    .gridlines{
      position:absolute; inset:0; pointer-events:none;
      background:
        linear-gradient(transparent 23px, rgba(255,255,255,.05) 24px),
        linear-gradient(90deg, transparent 23px, rgba(255,255,255,.05) 24px);
      background-size: 24px 24px;
      opacity: .45;
      mask-image: radial-gradient(circle at 50% 40%, rgba(0,0,0,.95), rgba(0,0,0,.15) 60%, transparent 78%);
    }
    .envelope .caption{
      position:absolute; left:18px; bottom:14px;
      color: rgba(255,255,255,.72);
      font-size: 12px;
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
    }
    .envelope .caption .key{
      padding:6px 10px; border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      font-weight:850;
    }

    .formGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    @media (max-width: 720px){ .formGrid{ grid-template-columns: 1fr; } }
    .input{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      border-radius: 14px;
      padding:10px 12px;
      color: rgba(255,255,255,.92);
      outline:none;
      width:100%;
      font-size: 13px;
    }
    .input:focus{ border-color: rgba(124,219,255,.55); box-shadow: 0 0 0 4px rgba(124,219,255,.10); }
    textarea.input{ min-height: 94px; resize: vertical; font-family: var(--mono); font-size: 12px; }

    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .toast{
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 18px;
      background: rgba(0,0,0,.62);
      border: 1px solid rgba(255,255,255,.14);
      padding:10px 12px;
      border-radius: 999px;
      color: rgba(255,255,255,.92);
      font-size: 13px;
      box-shadow: var(--shadow);
      opacity: 0;
      pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
      z-index: 999;
      backdrop-filter: blur(10px);
    }
    .toast.show{ opacity:1; transform: translateX(-50%) translateY(-2px); }

    /* Quiz */
    .quizTop{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between; }
    .progress{
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(255,255,255,.70);
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      padding:8px 10px;
      border-radius: 999px;
    }
    .qBox{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      border-radius: 16px;
      padding:14px;
      margin-top: 12px;
    }
    .qTitle{ font-weight:900; margin:0 0 8px; }
    .qStem{ color: var(--muted); line-height:1.7; margin:0 0 12px; }
    .opts{ display:grid; gap:10px; }
    .opt{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.14);
      border-radius: 14px;
      padding:10px 12px;
      cursor:pointer;
      display:flex; gap:10px; align-items:flex-start;
      transition: border-color .12s ease, background .12s ease, transform .08s ease;
    }
    .opt:hover{ transform: translateY(-1px); border-color: rgba(124,219,255,.35); }
    .opt .key{
      width:26px; height:26px; border-radius: 9px;
      display:flex; align-items:center; justify-content:center;
      font-weight:900; font-family: var(--mono);
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      flex: 0 0 auto;
    }
    .opt .text{ color: rgba(255,255,255,.90); line-height:1.55; }
    .opt.good{ border-color: rgba(91,255,178,.45); background: rgba(91,255,178,.10); }
    .opt.bad{ border-color: rgba(255,107,139,.45); background: rgba(255,107,139,.10); }
    .explain{
      margin-top: 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      padding:12px;
      color: rgba(255,255,255,.82);
      line-height:1.7;
      display:none;
    }
    .explain.show{ display:block; }
    .explain b{ color: rgba(255,255,255,.92); }

    /* Screenshot mode (9:16) */
    .shotMode body{}
    .shotFrame{
      display:none;
      position: fixed; inset: 0;
      background: rgba(0,0,0,.72);
      z-index: 1000;
      align-items:center; justify-content:center;
      padding: 18px;
    }
    .shotFrame.show{ display:flex; }
    .shotCanvas{
      width: min(420px, 92vw);
      aspect-ratio: 9 / 16;
      border-radius: 22px;
      border:1px solid rgba(255,255,255,.16);
      background: radial-gradient(700px 420px at 30% 10%, rgba(124,219,255,.18), transparent 55%),
                  radial-gradient(700px 420px at 80% 30%, rgba(155,124,255,.16), transparent 60%),
                  linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.24));
      overflow:hidden;
      box-shadow: var(--shadow);
      position: relative;
    }
    .shotHeader{
      padding: 16px;
      border-bottom:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
    }
    .shotHeader .t{ font-weight:950; font-size: 15px; }
    .shotHeader .s{ margin-top:6px; color: rgba(255,255,255,.70); font-size: 12px; line-height:1.5; }
    .shotBody{ padding: 14px 16px 56px; height: calc(100% - 74px); overflow:auto; }
    .shotFooter{
      position:absolute; left:0; right:0; bottom:0;
      padding: 10px 14px;
      display:flex; align-items:center; justify-content:space-between;
      border-top:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.22);
    }
    .wm{
      font-weight:950;
      font-size: 12px;
      letter-spacing: .8px;
      color: rgba(255,255,255,.82);
    }
    .wm small{ color: rgba(255,255,255,.58); font-weight:800; letter-spacing:.3px; }
    .closeX{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.92);
      border-radius: 999px;
      padding: 8px 10px;
      cursor:pointer;
      font-weight: 900;
    }

    /* Utilities */
    .muted{ color: var(--muted); }
    .divider{ height:1px; background: rgba(255,255,255,.08); margin: 10px 0; }
    .kbd{
      font-family: var(--mono);
      font-size: 12px;
      padding: 2px 6px;
      border-radius: 8px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.86);
    }
  </style>
</head>

<body>
  <div class="wrap" id="appRoot">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div class="titlebox">
          <div class="h1">æ‡‰ç”¨æ–‡ï½œæ›¸ä¿¡äº’å‹•æ•™å­¸</div>
          <div class="sub">ä¿¡å°æ ¼å¼ï¼ˆç›´å¼/æ©«å¼ï¼‰ï¼‹å¸¸è¦‹ç”¨èªï¼‹å°æ¸¬é©—ï¼ˆå–®æª”å¯é›¢ç·šä½¿ç”¨ï¼‰</div>
        </div>
      </div>
      <div class="controls">
        <div class="pill">å¿«æ·éµï¼š<span class="kbd">1~5</span> åˆ‡é ã€€<span class="kbd">?</span> é€ŸæŸ¥</div>
        <button class="btn ghost" id="btnCopyLink" title="å°‡ç›®å‰é é¢ç‹€æ…‹è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼ˆç”¨æ–¼å‚³çµ¦å­¸ç”Ÿï¼‰">ğŸ”— è¤‡è£½ç‹€æ…‹</button>
        <button class="btn" id="btnShot" title="é–‹å•Ÿ 9:16 æˆªåœ–æ¨¡å¼ï¼Œé©åˆæŠ•å½±/IG/ç°¡å ±æˆªåœ–">ğŸ“¸ æˆªåœ–æ¨¡å¼</button>
        <button class="btn primary" id="btnReset" title="æ¸…é™¤è¼¸å…¥èˆ‡é€²åº¦">â™»ï¸ é‡è¨­</button>
      </div>
    </div>

    <div class="grid">
      <aside class="side">
        <div class="section">
          <div class="meta">
            <span class="dot"></span>
            <span class="txt">ãˆã£ã¨ é€™ä»½å·¥å…·è®“ã€Œæ ¼å¼ã€è®Šæˆå¯ä»¥çœ‹å¾—è¦‹ã€æ”¹å¾—å‹•çš„æ±è¥¿ (à¸‡ â€¢Ì€_â€¢Ì)à¸‡</span>
          </div>
        </div>

        <div class="tabs" id="tabs">
          <div class="tab active" data-page="intro">æ¦‚å¿µé€Ÿè¦½ <small>æ ¸å¿ƒè¦é»</small></div>
          <div class="tab" data-page="v">ç›´å¼ä¿¡å° <small>ä½ç½®æ¼”ç·´</small></div>
          <div class="tab" data-page="h">æ©«å¼ä¿¡å° <small>ä½ç½®æ¼”ç·´</small></div>
          <div class="tab" data-page="terms">ç”¨èªé€ŸæŸ¥ <small>å•Ÿ/ç·˜/ç¨±è¬‚</small></div>
          <div class="tab" data-page="quiz">å°æ¸¬é©— <small>5 é¡Œå³æ™‚å›é¥‹</small></div>
        </div>

        <div class="section">
          <div class="meta">
            <span class="txt">æç¤ºï¼šä½ å¯ä»¥å…ˆæŠ•å½±ã€Œç›´å¼/æ©«å¼ã€è®“å­¸ç”Ÿæ”¹å…§å®¹ï¼Œå†åˆ‡åˆ°æ¸¬é©—æ”¶æŸã€‚</span>
          </div>
          <div class="divider"></div>
          <div class="row">
            <button class="btn" id="btnHints">ğŸ’¡ åˆ‡æ›æç¤º</button>
            <button class="btn" id="btnRandom">ğŸ² éš¨æ©Ÿç¤ºä¾‹</button>
          </div>
        </div>
      </aside>

      <main class="main">
        <div class="mainHeader">
          <div>
            <div class="h2" id="mainTitle">æ¦‚å¿µé€Ÿè¦½</div>
            <div class="desc" id="mainDesc">ç”¨æœ€çŸ­çš„å­—ï¼ŒæŠŠã€Œæ›¸ä¿¡åˆ°åº•åœ¨å¹¹å˜›ã€å’Œã€Œæ ¼å¼ç‚ºä»€éº¼é‡è¦ã€å…ˆé‡˜ä½ã€‚</div>
          </div>
          <div class="badge" id="mainBadge">Lesson Mode</div>
        </div>

        <div class="mainBody" id="mainBody"></div>
      </main>
    </div>
  </div>

  <!-- Screenshot Mode Overlay -->
  <div class="shotFrame" id="shotFrame" aria-hidden="true">
    <div class="shotCanvas">
      <div class="shotHeader">
        <div class="t" id="shotTitle">æˆªåœ–æ¨¡å¼</div>
        <div class="s" id="shotSub">æŠŠç•¶å‰é çš„é‡é»æ¿ƒç¸®æˆ 9:16ï¼Œæ–¹ä¾¿æˆªåœ–å¸¶èµ°ã€‚</div>
      </div>
      <div class="shotBody" id="shotBody"></div>
      <div class="shotFooter">
        <div class="wm">HLBH <small>åœ‹æ–‡ï½œæ‡‰ç”¨æ–‡</small></div>
        <button class="closeX" id="shotClose">é—œé–‰</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // -----------------------------
    // Data (based on provided material)
    // -----------------------------
    const DATA = {
      intro: {
        title: "æ¦‚å¿µé€Ÿè¦½",
        desc: "å…ˆæŠŠæ›¸ä¿¡çš„ç”¨é€”ã€ç‰¹è‰²ã€åŸºæœ¬è¦ç´ æŠ“ä½ï¼Œå¾Œé¢å†åšä¿¡å°/ç”¨èªçš„ç²¾æº–åŒ–ã€‚",
        badge: "Core",
        cards: [
          {
            h: "æ›¸ä¿¡æ˜¯ä»€éº¼ï¼Ÿ",
            p: "æ›¸ä¿¡æ˜¯ä¸€ç¨®ç”¨ä¾†è¯çµ¡æ„Ÿæƒ…ã€å‚³éè¨Šæ¯ã€è¡¨é”æ„è¦‹çš„æ‡‰ç”¨æ–‡æ›¸ã€‚å®ƒçš„ã€Œå½¢å¼ã€å’Œã€Œç¦®è²Œã€æœƒå½±éŸ¿å°æ–¹æ˜¯å¦é¡˜æ„è®€ã€æ˜¯å¦é¡˜æ„å›æ‡‰ã€‚"
          },
          {
            h: "ä¸‰å€‹é—œéµç‰¹è‰²",
            ul: [
              "æ ¼å¼å›ºå®šï¼šä¿¡å°ã€ä¿¡ç®‹å¤šéœ€ä¾å°æ‡‰æ ¼å¼æ›¸å¯«ã€‚",
              "ä¸»æ—¨æ˜ç¢ºï¼šå…§å®¹è¦æ¸…æ¥šæ‰¼è¦ï¼Œè®“äººä¸€çœ¼çŸ¥é“ä½ è¦ä»€éº¼ã€‚",
              "ä¾äººæ“‡è©ï¼šçœ‹å°è±¡èº«åˆ†/è¼©åˆ†ï¼Œé¸åˆé©ç”¨èªã€‚"
            ]
          },
          {
            h: "æ›¸ä¿¡çš„åŸºæœ¬è¦ç´ ï¼ˆå¤§æ–¹å‘ï¼‰",
            ul: [
              "ä¿¡å°ï¼šæ”¶ä¿¡äººè³‡è¨Šï¼ˆéƒµéå€è™Ÿ/åœ°å€/å§“å/ç¨±è¬‚/å•Ÿå°è©ï¼‰ã€å¯„ä¿¡äººè³‡è¨Šï¼ˆéƒµéå€è™Ÿ/åœ°å€/å§“å/ç·˜å°è©ï¼‰ã€‚",
              "ä¿¡ç®‹ï¼šå‰è¨€ï¼ˆç¨±è¬‚/æç¨±èª/å•Ÿäº‹æ•¬è©/æ‡‰é…¬èªç­‰ï¼‰ã€æ­£æ–‡ï¼ˆä¸»é«”å…§å®¹ï¼‰ã€çµèªï¼ˆæ‡‰é…¬èª/æ•¬è©/å•å€™/ç½²å/æ—¥æœŸç­‰ï¼‰ã€‚"
            ],
            hint: "é€™äº›è¦ç´ åœ¨æ•™æä¸­æœ‰æ˜ç¢ºæ¢åˆ—ï¼ˆä¿¡å°ã€ä¿¡ç®‹ï¼‰ã€‚"
          },
          {
            h: "ä¸Šèª²æ™‚å¯ä»¥é€™æ¨£æŠ“å­¸ç”Ÿ",
            p: "ä½ ä¸æ˜¯åœ¨èƒŒæ ¼å¼ï¼Œä½ æ˜¯åœ¨è¨“ç·´ä¸€ç¨®ã€Œè®“è³‡è¨Šä¸è¢«èª¤è®€ã€çš„èƒ½åŠ›ï¼šæ ¼å¼ï¼è®€è€…çš„å°èˆªã€‚å°èˆªéŒ¯äº†ï¼Œä¿¡å°±æœƒã€Œè·‘éŒ¯åœ°æ–¹ã€ã€‚"
          }
        ]
      },

      verticalEnvelope: {
        title: "ç›´å¼ä¿¡å°",
        desc: "ç›´å¼ä¿¡å°åˆ†å³/ä¸­/å·¦ä¸‰æ¬„ï¼šä¸­æ¬„æœ€é«˜ã€å³æ¬„ç•¥ä½ã€å·¦æ¬„æœ€ä½ã€‚éƒµç¥¨åœ¨å·¦ä¸Šè§’ï¼ˆæ¦‚å¿µç¤ºæ„ï¼‰ã€‚",
        badge: "Envelopeï½œç›´å¼",
        note: "ä½ å¯ä»¥æŠŠå³å´ç•¶ä½œå¯„ä»¶è³‡è¨Šã€ä¸­æ¬„ç•¶ä½œæ”¶ä»¶è³‡è¨Šã€å·¦æ¬„è£œå……æˆ–æ‹†è¡Œã€‚é‡é»æ˜¯ã€Œæ¬„ä½é«˜åº¦çš„é‚è¼¯ã€ã€‚",
        layout: {
          // positions are percentages (responsive)
          stamp: { right: 4, top: 5 }, // for appearance only
          receiver: { left: 35, top: 18, width: 33, height: 58, tag: "ä¸­æ¬„ãƒ»æ”¶ä¿¡äººï¼ˆæœ€é«˜ï¼‰" },
          sender:   { left: 68.5, top: 24, width: 28.5, height: 45, tag: "å³æ¬„ãƒ»å¯„ä¿¡äºº" },
          extra:    { left: 3, top: 30, width: 30, height: 45, tag: "å·¦æ¬„ãƒ»è£œå……/æ‹†è¡Œ" },
          caption: "ç›´å¼ï¼šä¸­æ¬„æœ€é«˜ã€å³æ¬„ç•¥ä½ã€å·¦æ¬„æœ€ä½"
        }
      },

      horizontalEnvelope: {
        title: "æ©«å¼ä¿¡å°",
        desc: "æ©«å¼ä¿¡å°å¸¸è¦‹å…©å€ï¼šå·¦ä¸Šå¯„ä¿¡äººè³‡è¨Šï¼›ä¸­é–“åå³ç‚ºæ”¶ä¿¡äººè³‡è¨Šã€‚éƒµç¥¨åœ¨å³ä¸Šè§’ï¼ˆæ¦‚å¿µç¤ºæ„ï¼‰ã€‚",
        badge: "Envelopeï½œæ©«å¼",
        note: "æ©«å¼æœ€å®¹æ˜“å‡ºäº‹ï¼šæœ‰äººæœƒç”¨ç›´å¼é‚è¼¯å…ˆå¯«æ”¶ä»¶äººï¼Œçµæœä¿¡ä»¶å¯èƒ½è¢«å¯„å›ï¼ˆå› ç‚ºä½ç½®ç†è§£åäº†ï¼‰ã€‚",
        layout: {
          stamp: { right: 4, top: 5 },
          sender:   { left: 4, top: 10, width: 42, height: 34, tag: "å·¦ä¸Šãƒ»å¯„ä¿¡äºº" },
          receiver: { left: 44, top: 38, width: 52, height: 40, tag: "ä¸­åå³ãƒ»æ”¶ä¿¡äºº" },
          extra:    { left: 4, top: 49, width: 40, height: 26, tag: "å‚™è¨»ï¼ˆé¸å¡«ï¼‰" },
          caption: "æ©«å¼ï¼šå…ˆçœ‹å·¦ä¸Šå¯„ä»¶ï¼Œå†çœ‹ä¸­åå³æ”¶ä»¶"
        }
      },

      terms: {
        title: "ç”¨èªé€ŸæŸ¥",
        desc: "æŠŠå¸¸è¦‹å•Ÿå°è©/ç·˜å°è©/ç¨±è¬‚åŸå‰‡æ•´ç†æˆä¸€å¼µå¯æŠ•å½±çš„é€ŸæŸ¥è¡¨ã€‚",
        badge: "Language",
        cards: [
          {
            h: "å•Ÿå°è©ï¼ˆçµ¦æ”¶ä¿¡äººçœ‹çš„ï¼‰",
            ul: [
              "ç”¨åœ¨éœ€è¦å°å£çš„ä¿¡ä»¶ï¼›ã€å•Ÿã€æœ‰æ‰“é–‹ã€å±•é–‹ä¹‹æ„ã€‚",
              "å¸¸è¦‹ï¼šé•·è¼©å¯ç”¨ã€Œç¦å•Ÿ/å®‰å•Ÿã€ã€å¸«é•·ã€Œé“å•Ÿã€ã€å¹³è¼©ã€Œå°å•Ÿ/å¤§å•Ÿã€ã€æ™šè¼©ã€Œæ”¶å•Ÿ/å•Ÿã€ã€‚"
            ],
            hint: "æ•™ææåˆ°ã€å•Ÿå°è©ã€æ˜¯å°æ”¶ä¿¡äººèªªçš„ã€åªç”¨æ–¼å°å£ä¿¡ä»¶ã€‚"
          },
          {
            h: "ç·˜å°è©ï¼ˆçµ¦æ”¶ä¿¡äººçœ‹çš„ï¼‰",
            ul: [
              "ä¹Ÿæ˜¯ç”¨åœ¨éœ€è¦å°å£çš„ä¿¡ä»¶ï¼›ã€ç·˜ã€æœ‰å°é–‰ã€å°ä¸Šä¹‹æ„ã€‚",
              "å°é•·è¼©å¸¸ç”¨ã€Œè¬¹ç·˜ã€ï¼›å¹³è¼©/æ™šè¼©å¯ç”¨ã€Œç·˜ã€ã€‚",
              "ä¹Ÿå¯ä¸ç”¨å•Ÿå°è©ï¼Œæ”¹ç”¨ã€Œæ”¶ã€å­—æ›¿ä»£ï¼ˆä»»ä½•é¡å‹éƒ½å¯ç”¨ï¼‰ã€‚"
            ]
          },
          {
            h: "å¸¸è¦‹èª¤ç”¨æé†’ï¼ˆå°é™·é˜±ï¼‰",
            p: "ä¿¡å°ä¸Šå¯«ã€Œæ•¬å•Ÿã€çœ‹ä¼¼ç¦®è²Œï¼Œå…¶å¯¦ç­‰æ–¼å°æ”¶ä¿¡äººèªªã€Œä½ è¦æ­æ•¬åœ°æ‰“é–‹ã€ï¼Œèªæ°£å®¹æ˜“è®Šå¾—é«˜é«˜åœ¨ä¸Šï¼Œåè€Œå¤±ç¦®ã€‚(Â´ãƒ»Ï‰ãƒ»ï½€)"
          },
          {
            h: "ç¨±è¬‚åŸå‰‡ï¼ˆè¶…å¯¦ç”¨ï¼‰",
            ul: [
              "çµ¦é•·è¼©ï¼šé€šå¸¸è¦å¯«ç¨±è¬‚ä»¥ç¤ºå°Šæ•¬ï¼›çµ¦å¹³/æ™šè¼©å¯åªå¯«åå­—ã€‚",
              "æåˆ°è‡ªå·±å®¶æ—è¦ªæˆšï¼šé•·è¼©åŠ ã€Œå®¶ã€ã€æ™šè¼©åŠ ã€Œèˆ/å°ã€ï¼›äº¡æ•…å‰‡é•·è¼©åŠ ã€Œå…ˆã€ã€æ™šè¼©åŠ ã€Œäº¡ã€ã€‚",
              "æåˆ°å°æ–¹å®¶æ—è¦ªæˆšï¼šåŠ ã€Œä»¤ã€æˆ–ã€Œå°Šã€ä»¥ç¤ºå°Šé‡ã€‚"
            ]
          }
        ]
      }
    };

    // -----------------------------
    // Simple quiz (5 questions)
    // -----------------------------
    const QUIZ = [
      {
        title: "Q1",
        stem: "æ›¸ä¿¡çš„ç‰¹è‰²ä¸­ï¼Œå“ªä¸€é …æœ€è²¼è¿‘ã€Œæ ¼å¼ã€çš„é‡è¦æ€§ï¼Ÿ",
        options: [
          "å…§å®¹è¶Šé•·è¶Šå¥½ï¼Œæ‰èƒ½é¡¯å¾—æœ‰èª æ„",
          "ä¿¡å°ã€ä¿¡ç®‹å¤šéœ€ä¾å°æ‡‰æ ¼å¼æ›¸å¯«",
          "æ›¸ä¿¡åªç”¨æ–¼å‚³éæƒ…ç·’ï¼Œä¸ç”¨å‚³éè¨Šæ¯",
          "åªè¦å­—æ¼‚äº®ï¼Œå°±ä¸éœ€è¦æ³¨æ„å°è±¡èº«åˆ†"
        ],
        answer: 1,
        explain: "æ›¸ä¿¡çš„ç‰¹è‰²ä¹‹ä¸€å°±æ˜¯<strong>æ ¼å¼å›ºå®š</strong>ï¼Œä¿¡å°èˆ‡ä¿¡ç®‹å¤šéœ€ä¾å°æ‡‰æ ¼å¼æ›¸å¯«ï¼Œæ‰èƒ½é™ä½èª¤è®€/èª¤æŠ•çš„é¢¨éšªã€‚"
      },
      {
        title: "Q2",
        stem: "ç›´å¼ä¿¡å°çš„æ¬„ä½é«˜åº¦é‚è¼¯ï¼Œä½•è€…æ­£ç¢ºï¼Ÿ",
        options: [
          "å·¦æ¬„æœ€é«˜ï¼Œä¸­æ¬„æœ€ä½",
          "ä¸­æ¬„æœ€é«˜ï¼Œå³æ¬„ç•¥ä½ï¼Œå·¦æ¬„æœ€ä½",
          "ä¸‰æ¬„ä¸€æ¨£é«˜ï¼Œæ²’æœ‰å·®åˆ¥",
          "å³æ¬„æœ€é«˜ï¼Œå…¶ä»–ä»»æ„"
        ],
        answer: 1,
        explain: "ç›´å¼ä¿¡å°åˆ†å³/ä¸­/å·¦ä¸‰æ¬„ï¼Œ<strong>ä¸­æ¬„é¦–å­—ä½ç½®æœ€é«˜</strong>ã€å³æ¬„ç•¥ä½ã€å·¦æ¬„æœ€ä½ã€‚"
      },
      {
        title: "Q3",
        stem: "æ©«å¼ä¿¡å°æœ€å®¹æ˜“å‡ºç¾çš„éŒ¯èª¤æ˜¯ä»€éº¼ï¼Ÿ",
        options: [
          "æŠŠéƒµç¥¨è²¼åœ¨å³ä¸Šè§’",
          "ç”¨è—ç­†æ›¸å¯«",
          "å¥—ç”¨ç›´å¼ä¿¡å°é‚è¼¯ï¼Œå…ˆå¯«æ”¶ä»¶äººå°è‡´ä½ç½®åˆ¤è®€éŒ¯",
          "æŠŠåœ°å€æ‹†æˆå…©è¡Œ"
        ],
        answer: 2,
        explain: "æ©«å¼ä¿¡å°æ‡‰å…ˆçœ‹å·¦ä¸Šå¯„ä»¶è³‡è¨Šï¼Œå†çœ‹ä¸­åå³æ”¶ä»¶è³‡è¨Šï¼›è‹¥ç”¨ç›´å¼é‚è¼¯å¥—ç”¨ï¼Œå®¹æ˜“å°è‡´èª¤æŠ•æˆ–å¯„å›ã€‚"
      },
      {
        title: "Q4",
        stem: "ä¸‹åˆ—å“ªå€‹è©å±¬æ–¼ã€Œç·˜å°è©ã€è€Œä¸”å¸¸ç”¨æ–¼é•·è¼©ï¼Ÿ",
        options: [
          "é“å•Ÿ",
          "è¬¹ç·˜",
          "å¤§å•Ÿ",
          "æ”¶å•Ÿ"
        ],
        answer: 1,
        explain: "ç·˜å°è©ç”¨æ–¼å°å£ä¿¡ä»¶ï¼›å°é•·è¼©å¸¸ç”¨<strong>è¬¹ç·˜</strong>ã€‚"
      },
      {
        title: "Q5",
        stem: "ã€Œæ•¬å•Ÿã€ç‚ºä»€éº¼å¸¸è¢«è¦–ç‚ºä¸åˆå®œï¼Ÿ",
        options: [
          "å› ç‚ºå­—å½¢å¤ªé›£å¯«",
          "å› ç‚ºæœƒè®“æ”¶ä¿¡äººå¿…é ˆç”¨ç´…ç­†å›è¦†",
          "å› ç‚ºç­‰æ–¼å«å°æ–¹ã€æ­æ•¬åœ°æ‰“é–‹ã€ï¼Œèªæ°£å¯èƒ½å¤±ç¦®",
          "å› ç‚ºåªé©ç”¨å¼”å”ä¿¡"
        ],
        answer: 2,
        explain: "ã€Œå•Ÿã€æ˜¯æ‰“é–‹ä¹‹æ„ï¼›å¯«ã€Œæ•¬å•Ÿã€åƒæ˜¯åœ¨å‘½ä»¤å°æ–¹æ­æ•¬åœ°æ‰“é–‹ï¼Œåè€Œå®¹æ˜“å¤±ç¦®ã€‚"
      }
    ];

    // -----------------------------
    // State / Storage
    // -----------------------------
    const STORAGE_KEY = "letter_app_v1_state";
    const state = {
      page: "intro",
      showHints: true,
      v: {
        senderName: "è³´åŒå­¸",
        senderZip: "970",
        senderAddr: "èŠ±è“®ç¸£èŠ±è“®å¸‚â—‹â—‹è·¯â—‹æ®µâ—‹â—‹è™Ÿ",
        receiverName: "èƒ¡ç¾…æ³¢å…ˆç”Ÿ",
        receiverZip: "100",
        receiverAddr: "è‡ºåŒ—å¸‚ä¸­æ­£å€â—‹â—‹è·¯â—‹æ®µâ—‹â—‹è™Ÿ",
        note: "ï¼ˆå·¦æ¬„å¯æ‹†è¡Œè£œå……ï¼Œè®“è¡Œæ•¸æ›´å¥½çœ‹ï¼‰",
        sealWord: "ç·˜",
        openWord: "å°å•Ÿ"
      },
      h: {
        senderName: "è³´åŒå­¸",
        senderZip: "970",
        senderAddr: "èŠ±è“®ç¸£èŠ±è“®å¸‚â—‹â—‹è·¯â—‹æ®µâ—‹â—‹è™Ÿ",
        receiverName: "èƒ¡ç¾…æ³¢ä¸»ä»»",
        receiverZip: "407",
        receiverAddr: "è‡ºä¸­å¸‚è¥¿å±¯å€â—‹â—‹è·¯â—‹æ®µâ—‹â—‹è™Ÿ",
        note: "ï¼ˆæé†’ï¼šæ©«å¼å…ˆå¯«å¯„ä»¶ï¼Œå†å¯«æ”¶ä»¶ï¼‰",
        sealWord: "ç·˜",
        openWord: "æ”¶"
      },
      quiz: {
        index: 0,
        correct: 0,
        answered: false
      }
    };

    function loadState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return;
        const saved = JSON.parse(raw);
        Object.assign(state, saved);
      }catch(e){}
    }
    function saveState(){
      try{
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      }catch(e){}
    }

    // -----------------------------
    // UI helpers
    // -----------------------------
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    function toast(msg){
      const t = $("#toast");
      t.textContent = msg;
      t.classList.add("show");
      setTimeout(()=>t.classList.remove("show"), 1500);
    }

    function setActiveTab(page){
      $$("#tabs .tab").forEach(el=>{
        el.classList.toggle("active", el.dataset.page === page);
      });
    }

    function setHeader(meta){
      $("#mainTitle").textContent = meta.title;
      $("#mainDesc").textContent = meta.desc;
      $("#mainBadge").textContent = meta.badge;
    }

    function escapeHtml(s){
      return (s ?? "").toString()
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // -----------------------------
    // Render: Intro / Terms
    // -----------------------------
    function renderCards(cards){
      const wrap = document.createElement("div");
      wrap.className = "cards";
      cards.forEach(c=>{
        const card = document.createElement("div");
        card.className = "card";
        const h3 = document.createElement("h3");
        h3.textContent = c.h;
        card.appendChild(h3);

        if(c.p){
          const p = document.createElement("p");
          p.textContent = c.p;
          card.appendChild(p);
        }

        if(c.ul){
          const ul = document.createElement("ul");
          c.ul.forEach(li=>{
            const item = document.createElement("li");
            item.textContent = li;
            ul.appendChild(item);
          });
          card.appendChild(ul);
        }

        if(c.hint){
          const hint = document.createElement("div");
          hint.className = "hint";
          hint.textContent = state.showHints ? `TIP: ${c.hint}` : "";
          card.appendChild(hint);
        }
        wrap.appendChild(card);
      });
      return wrap;
    }

    // -----------------------------
    // Render: Envelope simulator
    // -----------------------------
    function renderEnvelopeSim(kind){
      const isV = kind === "v";
      const def = isV ? DATA.verticalEnvelope : DATA.horizontalEnvelope;
      const s = isV ? state.v : state.h;

      const container = document.createElement("div");
      container.className = "simWrap";

      const top = document.createElement("div");
      top.className = "simTop";
      top.innerHTML = `
        <div class="pill">${escapeHtml(def.note)}</div>
        <div class="pill">æç¤ºï¼š${state.showHints ? "é–‹" : "é—œ"}ï¼ˆå¯ç”¨å·¦å´ã€Œåˆ‡æ›æç¤ºã€ï¼‰</div>
      `;
      container.appendChild(top);

      const form = document.createElement("div");
      form.className = "card";
      form.innerHTML = `
        <h3>å¯ç·¨è¼¯æ¬„ä½ï¼ˆç¾å ´æ¼”ç·´ç”¨ï¼‰</h3>
        <div class="formGrid">
          <div>
            <div class="muted" style="font-weight:800; margin-bottom:6px;">å¯„ä¿¡äºº</div>
            <input class="input" data-bind="${kind}.senderName" placeholder="å¯„ä¿¡äººå§“å" value="${escapeHtml(s.senderName)}"/>
            <div style="height:8px"></div>
            <input class="input" data-bind="${kind}.senderZip" placeholder="å¯„ä»¶éƒµéå€è™Ÿ" value="${escapeHtml(s.senderZip)}"/>
            <div style="height:8px"></div>
            <textarea class="input" data-bind="${kind}.senderAddr" placeholder="å¯„ä»¶åœ°å€ï¼ˆå¯å¤šè¡Œï¼‰">${escapeHtml(s.senderAddr)}</textarea>
            <div style="height:8px"></div>
            <input class="input" data-bind="${kind}.sealWord" placeholder="ç·˜å°è©ï¼ˆå¦‚ï¼šç·˜ï¼è¬¹ç·˜ï¼‰" value="${escapeHtml(s.sealWord)}"/>
          </div>
          <div>
            <div class="muted" style="font-weight:800; margin-bottom:6px;">æ”¶ä¿¡äºº</div>
            <input class="input" data-bind="${kind}.receiverName" placeholder="æ”¶ä¿¡äººå§“å/ç¨±è¬‚" value="${escapeHtml(s.receiverName)}"/>
            <div style="height:8px"></div>
            <input class="input" data-bind="${kind}.receiverZip" placeholder="æ”¶ä»¶éƒµéå€è™Ÿ" value="${escapeHtml(s.receiverZip)}"/>
            <div style="height:8px"></div>
            <textarea class="input" data-bind="${kind}.receiverAddr" placeholder="æ”¶ä»¶åœ°å€ï¼ˆå¯å¤šè¡Œï¼‰">${escapeHtml(s.receiverAddr)}</textarea>
            <div style="height:8px"></div>
            <input class="input" data-bind="${kind}.openWord" placeholder="å•Ÿå°è©/æ”¶ï¼ˆå¦‚ï¼šå°å•Ÿï¼é“å•Ÿï¼æ”¶ï¼‰" value="${escapeHtml(s.openWord)}"/>
          </div>
        </div>

        <div class="divider"></div>
        <div class="row">
          <input class="input" style="flex:1" data-bind="${kind}.note" placeholder="å‚™è¨»ï¼ˆå­¸ç”Ÿå¸¸çŠ¯éŒ¯æé†’/æ‹†è¡Œèªªæ˜ï¼‰" value="${escapeHtml(s.note)}"/>
          <button class="btn" data-action="fillDemo">âœï¸ å¡«å…¥ç¤ºä¾‹</button>
          <button class="btn" data-action="clear">ğŸ§¹ æ¸…ç©º</button>
        </div>
      `;
      container.appendChild(form);

      const sim = document.createElement("div");
      sim.className = "envelope";
      sim.innerHTML = `
        <div class="gridlines"></div>
        <div class="paper"></div>
        <div class="stamp">éƒµç¥¨<br/><span style="opacity:.75; font-size:11px;">ç¤ºæ„</span></div>

        <div class="field" id="fReceiver">
          <div class="label">
            <span>æ”¶ä¿¡äºº</span>
            <span class="tag">${escapeHtml(def.layout.receiver.tag)}</span>
          </div>
          <div class="value" id="vReceiver"></div>
        </div>

        <div class="field" id="fSender">
          <div class="label">
            <span>å¯„ä¿¡äºº</span>
            <span class="tag">${escapeHtml(def.layout.sender.tag)}</span>
          </div>
          <div class="value" id="vSender"></div>
        </div>

        <div class="field" id="fExtra">
          <div class="label">
            <span>å‚™è¨»</span>
            <span class="tag">${escapeHtml(def.layout.extra.tag)}</span>
          </div>
          <div class="value" id="vExtra"></div>
        </div>

        <div class="caption">
          <span class="key">${escapeHtml(def.layout.caption)}</span>
          <span class="key">å•Ÿï¼š${escapeHtml(s.openWord)}ã€€ç·˜ï¼š${escapeHtml(s.sealWord)}</span>
          ${state.showHints ? `<span class="key">TIPï¼šæ©«å¼ä¸è¦å¥—ç›´å¼é‚è¼¯</span>` : ``}
        </div>
      `;
      container.appendChild(sim);

      // Position fields
      const receiverBox = sim.querySelector("#fReceiver");
      const senderBox = sim.querySelector("#fSender");
      const extraBox = sim.querySelector("#fExtra");

      function applyBox(el, conf){
        el.style.left = conf.left + "%";
        el.style.top = conf.top + "%";
        el.style.width = conf.width + "%";
        el.style.height = conf.height + "%";
      }
      applyBox(receiverBox, def.layout.receiver);
      applyBox(senderBox, def.layout.sender);
      applyBox(extraBox, def.layout.extra);

      // Fill values
      function refreshValues(){
        const r = [
          `${s.receiverZip}`,
          `${s.receiverAddr}`,
          `${s.receiverName}ã€€${s.openWord}`
        ].filter(Boolean).join("\n");

        const p = [
          `${s.senderZip}`,
          `${s.senderAddr}`,
          `${s.senderName}ã€€${s.sealWord}`
        ].filter(Boolean).join("\n");

        sim.querySelector("#vReceiver").textContent = r;
        sim.querySelector("#vSender").textContent = p;
        sim.querySelector("#vExtra").textContent = s.note || "";

        // update caption open/seal
        const caps = sim.querySelectorAll(".caption .key");
        if(caps[1]) caps[1].textContent = `å•Ÿï¼š${s.openWord}ã€€ç·˜ï¼š${s.sealWord}`;
      }
      refreshValues();

      // Bind inputs
      form.querySelectorAll("[data-bind]").forEach(inp=>{
        inp.addEventListener("input", ()=>{
          const path = inp.dataset.bind; // "v.senderName"
          const [k, prop] = path.split(".");
          state[k][prop] = inp.value;
          saveState();
          refreshValues();
        });
      });

      // Buttons in form
      form.querySelectorAll("[data-action]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const act = btn.dataset.action;
          if(act === "fillDemo"){
            if(isV){
              Object.assign(state.v, {
                senderName: "è³´åŒå­¸",
                senderZip: "970",
                senderAddr: "èŠ±è“®ç¸£èŠ±è“®å¸‚ä¸­å±±è·¯äºŒæ®µ 88 è™Ÿ\nåœ‹ç«‹èŠ±è“®é«˜å•†",
                receiverName: "èƒ¡ç¾…æ³¢å…ˆç”Ÿ",
                receiverZip: "100",
                receiverAddr: "è‡ºåŒ—å¸‚ä¸­æ­£å€ä¸­å±±å—è·¯ 1 è™Ÿ\nâ—‹â—‹â—‹å®¤",
                note: "ï¼ˆå¯æŠŠåœ°å€æ‹†å…©è¡Œï¼Œç¸½è¡Œæ•¸æ›´æ•´é½Šï¼‰",
                sealWord: "ç·˜",
                openWord: "å°å•Ÿ"
              });
            }else{
              Object.assign(state.h, {
                senderName: "è³´åŒå­¸",
                senderZip: "970",
                senderAddr: "èŠ±è“®ç¸£èŠ±è“®å¸‚ä¸­å±±è·¯äºŒæ®µ 88 è™Ÿ\nåœ‹ç«‹èŠ±è“®é«˜å•†",
                receiverName: "èƒ¡ç¾…æ³¢ä¸»ä»»",
                receiverZip: "407",
                receiverAddr: "è‡ºä¸­å¸‚è¥¿å±¯å€è‡ºç£å¤§é“ä¸‰æ®µ 99 è™Ÿ\nâ—‹â—‹â—‹ç§‘",
                note: "ï¼ˆæ©«å¼ï¼šå·¦ä¸Šå¯„ä»¶ â†’ ä¸­åå³æ”¶ä»¶ï¼‰",
                sealWord: "ç·˜",
                openWord: "æ”¶"
              });
            }
            saveState();
            // re-render this page to update inputs quickly
            renderPage(state.page);
            toast("å·²å¡«å…¥ç¤ºä¾‹");
          }
          if(act === "clear"){
            const target = isV ? state.v : state.h;
            Object.keys(target).forEach(k=> target[k] = "");
            // keep some defaults
            target.sealWord = "ç·˜";
            target.openWord = "æ”¶";
            saveState();
            renderPage(state.page);
            toast("å·²æ¸…ç©º");
          }
        });
      });

      return container;
    }

    // -----------------------------
    // Render: Quiz
    // -----------------------------
    function renderQuiz(){
      const root = document.createElement("div");
      const idx = Math.max(0, Math.min(QUIZ.length - 1, state.quiz.index));
      const q = QUIZ[idx];

      const top = document.createElement("div");
      top.className = "quizTop";
      top.innerHTML = `
        <div class="progress">é€²åº¦ï¼š${idx+1}/${QUIZ.length}ã€€ï½œã€€ç­”å°ï¼š${state.quiz.correct}</div>
        <div class="row">
          <button class="btn" id="btnPrev">â¬…ï¸ ä¸Šä¸€é¡Œ</button>
          <button class="btn primary" id="btnNext">ä¸‹ä¸€é¡Œ â¡ï¸</button>
        </div>
      `;

      const box = document.createElement("div");
      box.className = "qBox";
      box.innerHTML = `
        <p class="qTitle">${escapeHtml(q.title)}ï¼ˆå–®é¸ï¼‰</p>
        <p class="qStem">${escapeHtml(q.stem)}</p>
        <div class="opts" id="opts"></div>
        <div class="explain" id="explain"></div>
      `;

      root.appendChild(top);
      root.appendChild(box);

      const opts = box.querySelector("#opts");
      const explain = box.querySelector("#explain");

      function lockOptions(lock){
        opts.querySelectorAll(".opt").forEach(el=>{
          el.style.pointerEvents = lock ? "none" : "auto";
          el.style.opacity = lock ? "0.92" : "1";
        });
      }

      q.options.forEach((t, i)=>{
        const el = document.createElement("div");
        el.className = "opt";
        el.innerHTML = `
          <div class="key">${String.fromCharCode(65+i)}</div>
          <div class="text">${escapeHtml(t)}</div>
        `;
        el.addEventListener("click", ()=>{
          if(state.quiz.answered) return;
          state.quiz.answered = true;

          const correct = i === q.answer;
          if(correct) state.quiz.correct += 1;

          // mark
          opts.querySelectorAll(".opt").forEach((o, j)=>{
            if(j === q.answer) o.classList.add("good");
            else if(j === i && !correct) o.classList.add("bad");
          });

          explain.innerHTML = `<b>è§£æï¼š</b>${q.explain}`;
          explain.classList.add("show");
          lockOptions(true);

          saveState();
          toast(correct ? "ç­”å°äº†ï¼" : "å†æƒ³ä¸€ä¸‹ï¼šçœ‹è§£ææŠ“é—œéµ");
        });
        opts.appendChild(el);
      });

      // show explain if already answered
      if(state.quiz.answered){
        explain.innerHTML = `<b>è§£æï¼š</b>${q.explain}`;
        explain.classList.add("show");
        lockOptions(true);
        // Also show correct marking (assume they answered; we can't reconstruct selected option)
        opts.querySelectorAll(".opt")[q.answer].classList.add("good");
      }

      top.querySelector("#btnPrev").addEventListener("click", ()=>{
        state.quiz.index = Math.max(0, state.quiz.index - 1);
        state.quiz.answered = false;
        saveState();
        renderPage("quiz");
      });
      top.querySelector("#btnNext").addEventListener("click", ()=>{
        state.quiz.index = Math.min(QUIZ.length - 1, state.quiz.index + 1);
        state.quiz.answered = false;
        saveState();
        renderPage("quiz");
      });

      return root;
    }

    // -----------------------------
    // Render page
    // -----------------------------
    function renderPage(page){
      state.page = page;
      saveState();
      setActiveTab(page);

      const body = $("#mainBody");
      body.innerHTML = "";

      if(page === "intro"){
        setHeader({ title: DATA.intro.title, desc: DATA.intro.desc, badge: DATA.intro.badge });
        body.appendChild(renderCards(DATA.intro.cards));
        body.appendChild(makeFootNote());
      }
      else if(page === "v"){
        setHeader({ title: DATA.verticalEnvelope.title, desc: DATA.verticalEnvelope.desc, badge: DATA.verticalEnvelope.badge });
        body.appendChild(renderEnvelopeSim("v"));
        body.appendChild(makeFootNote());
      }
      else if(page === "h"){
        setHeader({ title: DATA.horizontalEnvelope.title, desc: DATA.horizontalEnvelope.desc, badge: DATA.horizontalEnvelope.badge });
        body.appendChild(renderEnvelopeSim("h"));
        body.appendChild(makeFootNote());
      }
      else if(page === "terms"){
        setHeader({ title: DATA.terms.title, desc: DATA.terms.desc, badge: DATA.terms.badge });
        body.appendChild(renderCards(DATA.terms.cards.map(c=>{
          // inject hint toggling
          const cc = {...c};
          if(cc.hint && !state.showHints) delete cc.hint;
          return cc;
        })));
        body.appendChild(makeFootNote());
      }
      else if(page === "quiz"){
        setHeader({ title: "å°æ¸¬é©—", desc: "5 é¡Œå³æ™‚å›é¥‹ï¼šæŠŠã€Œæœƒå¯«ã€è®Šæˆã€Œæœƒåˆ¤æ–·ã€ã€‚", badge: "Quiz" });
        body.appendChild(renderQuiz());
        body.appendChild(makeFootNote());
      }

      // update screenshot panel content
      syncShotPanel();
    }

    function makeFootNote(){
      const foot = document.createElement("div");
      foot.className = "card";
      foot.style.marginTop = "12px";
      foot.innerHTML = `
        <h3>æ•™æä¾æ“šèˆ‡ä½¿ç”¨æé†’</h3>
        <p>
          æœ¬äº’å‹•é æ•´ç†è‡ªã€Œæ‡‰ç”¨æ–‡ãƒ»æ›¸ä¿¡ã€ï¼šæ›¸ä¿¡ç‰¹è‰²ã€ä¿¡å°/ä¿¡ç®‹è¦ç´ ã€ç›´å¼/æ©«å¼ä¿¡å°æ¬„ä½é‚è¼¯èˆ‡ç”¨èªï¼ˆå•Ÿå°è©/ç·˜å°è©ï¼‰ç­‰é‡é»ã€‚<br/>
          ä½ å¯ä»¥æŠŠå®ƒç•¶æˆã€Œæ ¼å¼å¯è¦–åŒ–ã€å·¥å…·ï¼šå­¸ç”Ÿåªè¦æ”¹å…§å®¹ï¼Œå°±èƒ½ç«‹åˆ»çœ‹è¦‹æ ¼å¼æ˜¯å¦åˆç†ã€‚
        </p>
        <div class="miniRow">
          <span class="chip">é›¢ç·šå¯ç”¨</span>
          <span class="chip">æŠ•å½±å‹å–„</span>
          <span class="chip">å¯æˆªåœ–å¸¶èµ°</span>
          <span class="chip">å¯ç•¶ä½œèª²å ‚å°è€ƒ</span>
        </div>
      `;
      return foot;
    }

    // -----------------------------
    // Screenshot mode sync
    // -----------------------------
    function syncShotPanel(){
      const shotTitle = $("#shotTitle");
      const shotSub = $("#shotSub");
      const shotBody = $("#shotBody");

      const page = state.page;
      const titleMap = {
        intro: "æ¦‚å¿µé€Ÿè¦½ï¼ˆæˆªåœ–ï¼‰",
        v: "ç›´å¼ä¿¡å°ï¼ˆæˆªåœ–ï¼‰",
        h: "æ©«å¼ä¿¡å°ï¼ˆæˆªåœ–ï¼‰",
        terms: "ç”¨èªé€ŸæŸ¥ï¼ˆæˆªåœ–ï¼‰",
        quiz: "å°æ¸¬é©—ï¼ˆæˆªåœ–ï¼‰"
      };

      shotTitle.textContent = titleMap[page] || "æˆªåœ–æ¨¡å¼";
      shotSub.textContent = "æŠŠä½ ç¾åœ¨æŠ•å½±/è¬›çš„é‡é»æ¿ƒç¸®æˆä¸€å¼µ 9:16ã€‚";

      shotBody.innerHTML = "";

      const card = document.createElement("div");
      card.className = "card";
      card.style.background = "rgba(255,255,255,.05)";

      if(page === "intro"){
        card.innerHTML = `
          <h3>ä¸‰å€‹é—œéµç‰¹è‰²</h3>
          <ul>
            <li><b>æ ¼å¼å›ºå®š</b>ï¼šä¿¡å°/ä¿¡ç®‹ä¾å°æ‡‰æ ¼å¼æ›¸å¯«ã€‚</li>
            <li><b>ä¸»æ—¨æ˜ç¢º</b>ï¼šæ¸…æ¥šæ‰¼è¦ã€è®“äººä¸€çœ¼çœ‹æ‡‚ã€‚</li>
            <li><b>ä¾äººæ“‡è©</b>ï¼šçœ‹èº«åˆ†/è¼©åˆ†é¸ç”¨èªã€‚</li>
          </ul>
          <div class="divider"></div>
          <p class="muted">æ ¼å¼ä¸æ˜¯è£é£¾ï¼Œæ˜¯è®€è€…çš„å°èˆªã€‚(à¸‡ â€¢Ì€_â€¢Ì)à¸‡</p>
        `;
      }
      else if(page === "v" || page === "h"){
        const s = (page === "v") ? state.v : state.h;
        const caption = (page === "v")
          ? "ç›´å¼ï¼šä¸­æ¬„æœ€é«˜ã€å³æ¬„ç•¥ä½ã€å·¦æ¬„æœ€ä½"
          : "æ©«å¼ï¼šå·¦ä¸Šå¯„ä»¶ â†’ ä¸­åå³æ”¶ä»¶";
        card.innerHTML = `
          <h3>${caption}</h3>
          <p class="muted">æ”¶ä¿¡äºº</p>
          <pre style="margin:8px 0 12px; padding:10px; border-radius:14px; border:1px solid rgba(255,255,255,.12); background: rgba(0,0,0,.18); color: rgba(255,255,255,.88); font-family: var(--mono); font-size: 12px; white-space: pre-wrap;">${escapeHtml(`${s.receiverZip}\n${s.receiverAddr}\n${s.receiverName} ${s.openWord}`)}</pre>
          <p class="muted">å¯„ä¿¡äºº</p>
          <pre style="margin:8px 0 0; padding:10px; border-radius:14px; border:1px solid rgba(255,255,255,.12); background: rgba(0,0,0,.18); color: rgba(255,255,255,.88); font-family: var(--mono); font-size: 12px; white-space: pre-wrap;">${escapeHtml(`${s.senderZip}\n${s.senderAddr}\n${s.senderName} ${s.sealWord}`)}</pre>
        `;
      }
      else if(page === "terms"){
        card.innerHTML = `
          <h3>å•Ÿï¼ç·˜ï¼ç¨±è¬‚ï¼ˆé€ŸæŸ¥ï¼‰</h3>
          <ul>
            <li><b>å•Ÿå°è©</b>ï¼šçµ¦æ”¶ä¿¡äººçœ‹çš„ï¼Œç”¨æ–¼å°å£ä¿¡ä»¶ã€‚</li>
            <li><b>ç·˜å°è©</b>ï¼šã€Œè¬¹ç·˜ã€å¤šç”¨é•·è¼©ï¼›å¹³/æ™šè¼©å¯ç”¨ã€Œç·˜ã€ã€‚</li>
            <li><b>ç¨±è¬‚</b>ï¼šçœ‹è¼©åˆ†ï¼›æåˆ°å°æ–¹å®¶äººåŠ ã€Œä»¤/å°Šã€ã€‚</li>
          </ul>
          <div class="divider"></div>
          <p class="muted">æ³¨æ„ï¼šã€Œæ•¬å•Ÿã€å¸¸è¢«è¦–ç‚ºä¸åˆå®œã€‚</p>
        `;
      }
      else if(page === "quiz"){
        card.innerHTML = `
          <h3>å°æ¸¬é©—ç‹€æ…‹</h3>
          <p class="muted">ç­”å°ï¼š${state.quiz.correct} / ${QUIZ.length}</p>
          <div class="divider"></div>
          <p class="muted">å»ºè­°ï¼šåšå®Œç«‹åˆ»å›åˆ°ä¿¡å°é ï¼Œè®“å­¸ç”Ÿç”¨éŒ¯é¡Œå»ä¿®æ­£æ ¼å¼/ç”¨èªã€‚</p>
        `;
      }

      shotBody.appendChild(card);
    }

    // -----------------------------
    // Random examples + hint toggle + reset + share state
    // -----------------------------
    function randomExample(){
      const recvNames = ["èƒ¡ç¾…æ³¢å…ˆç”Ÿ", "ç‹å°æ˜è€å¸«", "æ—â—‹â—‹ä¸»ä»»", "é™³åŒå­¸", "å¼µâ—‹â—‹å°å§"];
      const sendNames = ["è³´åŒå­¸", "é»ƒåŒå­¸", "æåŒå­¸", "å³åŒå­¸", "è¬åŒå­¸"];
      const zips = ["100","103","106","220","300","407","500","600","701","900","970"];
      const addrSeeds = [
        "è‡ºåŒ—å¸‚ä¸­æ­£å€â—‹â—‹è·¯â—‹æ®µâ—‹â—‹è™Ÿ",
        "æ–°åŒ—å¸‚æ¿æ©‹å€â—‹â—‹è·¯â—‹æ®µâ—‹â—‹è™Ÿ",
        "æ¡ƒåœ’å¸‚ä¸­å£¢å€â—‹â—‹è·¯â—‹æ®µâ—‹â—‹è™Ÿ",
        "è‡ºä¸­å¸‚è¥¿å±¯å€â—‹â—‹è·¯â—‹æ®µâ—‹â—‹è™Ÿ",
        "è‡ºå—å¸‚æ±å€â—‹â—‹è·¯â—‹æ®µâ—‹â—‹è™Ÿ",
        "é«˜é›„å¸‚è‹“é›…å€â—‹â—‹è·¯â—‹æ®µâ—‹â—‹è™Ÿ",
        "èŠ±è“®ç¸£èŠ±è“®å¸‚â—‹â—‹è·¯â—‹æ®µâ—‹â—‹è™Ÿ"
      ];
      const pick = arr => arr[Math.floor(Math.random()*arr.length)];

      state.v.receiverName = pick(recvNames);
      state.v.senderName = pick(sendNames);
      state.v.receiverZip = pick(zips);
      state.v.senderZip = pick(zips);
      state.v.receiverAddr = pick(addrSeeds) + "\nâ—‹â—‹â—‹å®¤";
      state.v.senderAddr = pick(addrSeeds) + "\nåœ‹ç«‹èŠ±è“®é«˜å•†";
      state.v.openWord = "å°å•Ÿ";
      state.v.sealWord = "ç·˜";
      state.v.note = "ï¼ˆç›´å¼ï¼šä¸­æ¬„æœ€é«˜ï¼‰";

      state.h.receiverName = pick(recvNames).replace("å…ˆç”Ÿ","ä¸»ä»»");
      state.h.senderName = pick(sendNames);
      state.h.receiverZip = pick(zips);
      state.h.senderZip = pick(zips);
      state.h.receiverAddr = pick(addrSeeds) + "\nâ—‹â—‹â—‹ç§‘";
      state.h.senderAddr = pick(addrSeeds) + "\nåœ‹ç«‹èŠ±è“®é«˜å•†";
      state.h.openWord = "æ”¶";
      state.h.sealWord = "ç·˜";
      state.h.note = "ï¼ˆæ©«å¼ï¼šå·¦ä¸Šå¯„ä»¶ â†’ ä¸­åå³æ”¶ä»¶ï¼‰";

      saveState();
      renderPage(state.page);
      toast("å·²ç”¢ç”Ÿéš¨æ©Ÿç¤ºä¾‹");
    }

    function resetAll(){
      localStorage.removeItem(STORAGE_KEY);
      location.reload();
    }

    function copyStatus(){
      const payload = {
        page: state.page,
        showHints: state.showHints,
        v: state.v,
        h: state.h,
        quiz: { index: state.quiz.index, correct: state.quiz.correct }
      };
      const text = btoa(unescape(encodeURIComponent(JSON.stringify(payload))));
      const url = location.href.split("#")[0] + "#s=" + text;
      navigator.clipboard.writeText(url).then(()=>{
        toast("å·²è¤‡è£½ï¼ˆè²¼åˆ° LINE/ç­ç¾¤å³å¯ï¼‰");
      }).catch(()=>{
        // fallback: copy just the hash
        navigator.clipboard.writeText(location.href).then(()=>toast("å·²è¤‡è£½ç¶²å€")).catch(()=>toast("è¤‡è£½å¤±æ•—ï¼šå¯æ‰‹å‹•è¤‡è£½ç¶²å€åˆ—"));
      });
    }

    function applyHashState(){
      const hash = location.hash || "";
      const m = hash.match(/#s=([A-Za-z0-9+/=]+)/);
      if(!m) return;
      try{
        const raw = decodeURIComponent(escape(atob(m[1])));
        const obj = JSON.parse(raw);
        if(obj && typeof obj === "object"){
          state.page = obj.page ?? state.page;
          state.showHints = (obj.showHints ?? state.showHints);
          if(obj.v) state.v = {...state.v, ...obj.v};
          if(obj.h) state.h = {...state.h, ...obj.h};
          if(obj.quiz){
            state.quiz.index = obj.quiz.index ?? state.quiz.index;
            state.quiz.correct = obj.quiz.correct ?? state.quiz.correct;
            state.quiz.answered = false;
          }
          saveState();
        }
      }catch(e){}
    }

    // -----------------------------
    // Init / Events
    // -----------------------------
    function init(){
      loadState();
      applyHashState();

      // tabs
      $$("#tabs .tab").forEach(tab=>{
        tab.addEventListener("click", ()=>{
          const page = tab.dataset.page;
          if(page === "v") renderPage("v");
          else if(page === "h") renderPage("h");
          else if(page === "terms") renderPage("terms");
          else if(page === "quiz") renderPage("quiz");
          else renderPage("intro");
        });
      });

      // buttons
      $("#btnHints").addEventListener("click", ()=>{
        state.showHints = !state.showHints;
        saveState();
        renderPage(state.page);
        toast(state.showHints ? "æç¤ºå·²é–‹" : "æç¤ºå·²é—œ");
      });

      $("#btnRandom").addEventListener("click", randomExample);
      $("#btnReset").addEventListener("click", resetAll);
      $("#btnCopyLink").addEventListener("click", copyStatus);

      // screenshot mode
      $("#btnShot").addEventListener("click", ()=>{
        syncShotPanel();
        $("#shotFrame").classList.add("show");
        $("#shotFrame").setAttribute("aria-hidden","false");
      });
      $("#shotClose").addEventListener("click", ()=>{
        $("#shotFrame").classList.remove("show");
        $("#shotFrame").setAttribute("aria-hidden","true");
      });
      $("#shotFrame").addEventListener("click", (e)=>{
        if(e.target.id === "shotFrame"){
          $("#shotFrame").classList.remove("show");
          $("#shotFrame").setAttribute("aria-hidden","true");
        }
      });

      // keyboard shortcuts
      window.addEventListener("keydown", (e)=>{
        if(e.key === "1") renderPage("intro");
        if(e.key === "2") renderPage("v");
        if(e.key === "3") renderPage("h");
        if(e.key === "4") renderPage("terms");
        if(e.key === "5") renderPage("quiz");
        if(e.key === "?"){
          alert(
`å¿«æ·éµï¼š\n1 æ¦‚å¿µé€Ÿè¦½\n2 ç›´å¼ä¿¡å°\n3 æ©«å¼ä¿¡å°\n4 ç”¨èªé€ŸæŸ¥\n5 å°æ¸¬é©—\n\nå°æŠ€å·§ï¼š\n- ç”¨ã€Œéš¨æ©Ÿç¤ºä¾‹ã€å¿«é€Ÿæ›ä¸€çµ„è³‡æ–™\n- ç”¨ã€Œæˆªåœ–æ¨¡å¼ã€åš 9:16 é‡é»åœ–`
          );
        }
        if(e.key.toLowerCase() === "h"){
          state.showHints = !state.showHints;
          saveState();
          renderPage(state.page);
        }
      });

      // first render
      renderPage(state.page || "intro");
    }

    init();
  </script>
</body>
</html>
